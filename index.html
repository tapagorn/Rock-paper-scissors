<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏´‡∏ô‡∏≤‡∏ô‡∏´‡∏•‡πà‡∏≠ - ‡πÄ‡∏õ‡πà‡∏≤‡∏¢‡∏¥‡πâ‡∏á‡∏â‡∏∏‡∏ö‡∏ß‡∏±‡∏î‡∏î‡∏ß‡∏á</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Sarabun:wght@400;600;800&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- FingerprintJS -->
    <script>
        const fpPromise = import('https://openfpcdn.io/fingerprintjs/v4')
            .then(FingerprintJS => FingerprintJS.load());
    </script>

    <style>
        body {
            font-family: 'Poppins', 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #60a5fa 100%);
            height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
        }

        /* Glassmorphism Classes */
        .glass-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        .glass-btn {
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.05) 100%);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-btn:hover:not(:disabled) {
            transform: translateY(-4px);
            background: rgba(255,255,255,0.25);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            border-color: rgba(255,255,255,0.8);
        }

        .glass-btn:active:not(:disabled) {
            transform: scale(0.95);
        }

        .glass-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(1);
        }

        /* Animations */
        @keyframes bounce-hand {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        .animate-bounce-hand { animation: bounce-hand 0.5s infinite; }

        @keyframes shake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(-15deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(15deg); }
            100% { transform: rotate(0deg); }
        }
        .shake-hand { animation: shake 0.5s ease-in-out infinite; }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .modal-enter { animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

        /* Admin Styles */
        .admin-row:nth-child(even) { background-color: rgba(255, 255, 255, 0.05); }
        .admin-row:hover { background-color: rgba(255, 255, 255, 0.1); }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 3px; }

        .emoji-xl { font-size: 4rem; line-height: 1; }
        .emoji-lg { font-size: 2.5rem; line-height: 1; }
        
        /* Helper for cooldown inputs */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
    </style>
</head>
<body class="text-white select-none flex flex-col items-center justify-center relative p-4">

    <!-- Header Section -->
    <header class="w-full max-w-md flex justify-between items-center mb-4 z-10">
        <div class="flex items-center gap-2 cursor-pointer select-none active:opacity-70 transition-opacity" id="adminTrigger">
            <div class="bg-white/20 p-2 rounded-lg backdrop-blur-sm">
                <i data-lucide="gift" class="w-6 h-6 text-yellow-300"></i>
            </div>
            <span class="font-bold text-lg tracking-wide uppercase text-white/90">‡∏£‡πâ‡∏≤‡∏ô<span class="text-yellow-300">‡∏´‡∏ô‡∏≤‡∏ô‡∏´‡∏•‡πà‡∏≠</span></span>
        </div>
        
        <button id="soundToggle" class="p-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors backdrop-blur-sm">
            <i id="soundIcon" data-lucide="volume-2" class="w-5 h-5"></i>
        </button>
    </header>

    <!-- Main Game Container -->
    <main class="w-full max-w-md flex flex-col items-center z-10 relative">
        <div class="text-center mb-6">
            <h1 class="text-4xl md:text-5xl font-extrabold mb-2 drop-shadow-lg leading-normal">
                ‡πÄ‡∏õ‡πà‡∏≤‡∏¢‡∏¥‡πâ‡∏á‡∏â‡∏∏‡∏ö <br/>
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-yellow-500">‡∏ß‡∏±‡∏î‡∏î‡∏ß‡∏á‡∏£‡∏±‡∏ö‡πÇ‡∏ä‡∏Ñ</span>
            </h1>
            <p class="text-white/80 text-sm md:text-base font-light">‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤: ‡∏ä‡∏ô‡∏∞ 2 ‡πÉ‡∏ô 3 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</p>
        </div>

        <!-- Scoreboard -->
        <div id="scoreboard" class="w-full max-w-xs mb-4 flex justify-between items-center px-6 py-2 bg-white/10 rounded-full backdrop-blur-sm border border-white/10 hidden">
            <div class="flex flex-col items-center">
                <span class="text-xs opacity-70">‡∏Ñ‡∏∏‡∏ì</span>
                <span id="pScore" class="text-2xl font-bold text-blue-300">0</span>
            </div>
            <div class="text-xs font-bold text-yellow-400 bg-yellow-400/20 px-2 py-1 rounded">
                RACE TO 2
            </div>
            <div class="flex flex-col items-center">
                <span class="text-xs opacity-70">‡∏´‡∏ô‡∏≤‡∏ô‡∏´‡∏•‡πà‡∏≠</span>
                <span id="cScore" class="text-2xl font-bold text-red-300">0</span>
            </div>
        </div>

        <!-- Cooldown / Limit Message (Shows when blocked) -->
        <div id="cooldownMsg" class="hidden w-full max-w-md bg-red-500/20 border border-red-500/50 rounded-xl p-4 text-center mb-6 backdrop-blur-sm">
            <i data-lucide="clock" class="w-8 h-8 mx-auto mb-2 text-red-300"></i>
            <h3 class="text-lg font-bold text-red-100">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡πà‡∏ô‡∏£‡∏≠‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</h3>
            <p class="text-sm text-red-200/80 mb-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà</p>
            <div id="countdownTimer" class="text-xl font-mono font-bold text-white bg-black/30 inline-block px-3 py-1 rounded-lg">
                --:--:--
            </div>
        </div>

        <!-- Game Area -->
        <div id="gameArea" class="w-full transition-opacity duration-500">
            <!-- Battle Arena -->
            <div id="battleArena" class="hidden h-48 mb-6 relative flex justify-center items-center gap-8">
                <div class="text-center transform transition-all duration-300" id="playerHandDisplay">
                    <div class="w-24 h-24 bg-white/10 rounded-full flex items-center justify-center border-4 border-blue-400 shadow-lg glass-panel transition-all" id="pHandBorder">
                        <span class="emoji-xl" id="playerEmoji">‚úä</span>
                    </div>
                </div>
                <div class="text-2xl font-black text-yellow-400 italic absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-20 drop-shadow-lg">VS</div>
                <div class="text-center transform transition-all duration-300" id="cpuHandDisplay">
                    <div class="w-24 h-24 bg-white/10 rounded-full flex items-center justify-center border-4 border-red-400 shadow-lg glass-panel transition-all" id="cHandBorder">
                        <span class="emoji-xl" id="cpuEmoji">‚úä</span>
                    </div>
                </div>
            </div>

            <!-- Selection Controls -->
            <div id="controls" class="grid grid-cols-3 gap-3 w-full mb-6">
                <button onclick="playRound('rock')" class="glass-btn rounded-2xl p-4 flex flex-col items-center justify-center gap-2 group h-32">
                    <span class="emoji-lg group-hover:scale-110 transition-transform">‚úä</span>
                    <span class="font-bold text-sm">‡∏Ñ‡πâ‡∏≠‡∏ô</span>
                </button>
                <button onclick="playRound('paper')" class="glass-btn rounded-2xl p-4 flex flex-col items-center justify-center gap-2 group h-32">
                    <span class="emoji-lg group-hover:scale-110 transition-transform">‚úã</span>
                    <span class="font-bold text-sm">‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©</span>
                </button>
                <button onclick="playRound('scissors')" class="glass-btn rounded-2xl p-4 flex flex-col items-center justify-center gap-2 group h-32">
                    <span class="emoji-lg group-hover:scale-110 transition-transform">‚úåÔ∏è</span>
                    <span class="font-bold text-sm">‡∏Å‡∏£‡∏£‡πÑ‡∏Å‡∏£</span>
                </button>
            </div>

            <div id="statusText" class="text-center h-8 font-bold text-yellow-200 text-lg animate-pulse">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏ß‡∏∏‡∏ò‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì!</div>
        </div>

        <!-- View Result Button -->
        <button id="viewResultBtn" class="hidden w-full max-w-xs mx-auto py-3 rounded-xl bg-white/20 hover:bg-white/30 backdrop-blur-sm border border-white/30 text-white font-semibold transition-all shadow-lg active:scale-95 mb-4 flex items-center justify-center gap-2">
            <i data-lucide="eye" class="w-5 h-5"></i>
            ‡∏î‡∏π‡∏ú‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        </button>

        <div class="mt-8 text-center opacity-60 text-xs">
            <p>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏à‡∏≤‡∏Å ‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡∏≤‡∏ô‡∏´‡∏•‡πà‡∏≠</p>
        </div>
    </main>

    <!-- Result Modal -->
    <div id="resultModal" class="fixed inset-0 z-50 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300 bg-black/60 backdrop-blur-sm">
        <div id="modalCard" class="glass-panel w-11/12 max-w-sm p-8 rounded-3xl text-center transform scale-90 transition-transform duration-300 border-t border-white/40">
            <div id="modalIconContainer" class="mx-auto w-24 h-24 rounded-full flex items-center justify-center mb-4 shadow-xl border-4 border-white/20">
                <span id="modalEmoji" class="text-5xl">üèÜ</span>
            </div>
            <h2 id="modalTitle" class="text-3xl font-extrabold mb-2 tracking-tight">You Won!</h2>
            <p id="modalMessage" class="text-white/80 mb-6 font-light">Congratulations!</p>
            <div id="rewardSection" class="hidden mb-6 bg-black/20 rounded-xl p-4 border border-white/10">
                <p class="text-xs text-white/50 uppercase tracking-widest mb-2">‡πÅ‡∏Ñ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</p>
                <div class="bg-white/10 rounded-lg p-2 backdrop-blur-md">
                    <code class="text-2xl font-mono text-yellow-300 font-bold select-all tracking-wider" id="rewardCode">Waiting...</code>
                </div>
            </div>
            <button id="closeModalBtn" onclick="toggleModal(false)" class="hidden w-full py-3 rounded-xl bg-white/10 hover:bg-white/20 mb-2 transition-colors">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="fixed inset-0 z-[70] flex items-center justify-center hidden bg-black/80 backdrop-blur-sm">
        <div class="glass-panel w-11/12 max-w-xs p-6 rounded-2xl text-center shadow-2xl">
            <div class="mx-auto w-12 h-12 bg-white/10 rounded-full flex items-center justify-center mb-4">
                <i data-lucide="lock" class="text-white w-6 h-6"></i>
            </div>
            <h3 class="text-xl font-bold mb-4 text-white">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</h3>
            <input type="password" id="adminPasswordInput" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" class="w-full bg-black/30 border border-white/20 rounded-lg p-3 text-white placeholder-white/40 mb-4 focus:outline-none focus:border-yellow-400 text-center tracking-widest">
            <div class="flex gap-2">
                <button id="cancelLoginBtn" class="flex-1 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-white text-sm font-medium transition-colors">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirmLoginBtn" class="flex-1 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 text-white font-bold text-sm shadow-lg transition-colors">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
            <p id="loginErrorMsg" class="text-red-400 text-xs mt-3 hidden">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="adminModal" class="fixed inset-0 z-[60] flex items-center justify-center hidden bg-black/90 backdrop-blur-xl">
        <div class="w-11/12 max-w-4xl h-[90vh] bg-slate-900 border border-slate-700 rounded-2xl flex flex-col shadow-2xl overflow-hidden text-sm">
            <!-- Admin Header -->
            <div class="p-4 bg-slate-800 border-b border-slate-700 flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <i data-lucide="database" class="text-blue-400"></i>
                    <div>
                        <h2 class="font-bold text-lg text-white">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</h2>
                        <span id="syncStatus" class="text-xs text-slate-400 font-normal flex items-center gap-1">
                            <span class="w-2 h-2 rounded-full bg-yellow-500"></span> LocalStorage (Sync: <span id="gsStatus">...</span>)
                        </span>
                    </div>
                </div>
                <button onclick="toggleAdminPanel(false)" class="p-1.5 hover:bg-white/10 rounded-full transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-slate-400"></i>
                </button>
            </div>

            <!-- Admin Settings Section -->
            <div class="p-4 bg-slate-800/50 border-b border-slate-700">
                <h3 class="font-bold text-white mb-3 flex items-center gap-2">
                    <i data-lucide="settings" class="w-4 h-4 text-yellow-400"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏ã‡πâ‡∏≥ (Cooldown)
                </h3>
                <div class="flex flex-col md:flex-row gap-3 items-end">
                    <div class="w-full md:w-auto">
                        <label class="block text-xs text-slate-400 mb-1">‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏ã‡πâ‡∏≥</label>
                        <select id="adminCooldownType" class="bg-slate-700 text-white border border-slate-600 rounded px-3 py-2 text-sm w-full outline-none focus:border-blue-500" onchange="updateAdminUI()">
                            <option value="none">‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡∏ï‡∏•‡∏≠‡∏î‡πÑ‡∏õ)</option>
                            <option value="hour">‡∏ó‡∏∏‡∏Å‡πÜ ... ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                            <option value="day">‡∏ó‡∏∏‡∏Å‡πÜ ... ‡∏ß‡∏±‡∏ô</option>
                        </select>
                    </div>
                    <div id="adminCooldownValueContainer" class="w-full md:w-auto hidden">
                        <label class="block text-xs text-slate-400 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ß‡∏•‡∏≤</label>
                        <input type="number" id="adminCooldownValue" min="1" value="1" class="bg-slate-700 text-white border border-slate-600 rounded px-3 py-2 text-sm w-24 outline-none focus:border-blue-500 text-center">
                    </div>
                    <button onclick="saveAdminSettings()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded text-sm font-bold shadow-lg transition-colors flex items-center gap-2">
                        <i data-lucide="save" class="w-4 h-4"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                    </button>
                    <span id="saveStatus" class="text-green-400 text-xs hidden">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!</span>
                </div>
                <p class="text-xs text-slate-500 mt-2">* ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏∞‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ï‡∏≤‡∏° Visitor ID</p>
            </div>

            <!-- Admin Table -->
            <div class="flex-1 overflow-auto custom-scroll p-4">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-bold text-slate-300">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                    <div class="flex gap-2">
                        <button onclick="exportLogs()" class="px-2 py-1 bg-green-600/80 hover:bg-green-500 rounded text-xs text-white flex gap-1"><i data-lucide="download" class="w-3 h-3"></i> CSV</button>
                        <button onclick="clearLogs()" class="px-2 py-1 bg-red-600/80 hover:bg-red-500 rounded text-xs text-white flex gap-1"><i data-lucide="trash-2" class="w-3 h-3"></i> Clear</button>
                    </div>
                </div>
                <table class="w-full text-left border-collapse">
                    <thead class="sticky top-0 bg-slate-900 z-10 shadow-md">
                        <tr class="text-slate-400 text-xs uppercase tracking-wider">
                            <th class="p-3 font-semibold">‡πÄ‡∏ß‡∏•‡∏≤</th>
                            <th class="p-3 font-semibold">Visitor ID</th>
                            <th class="p-3 font-semibold text-center">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</th>
                            <th class="p-3 font-semibold text-right">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</th>
                        </tr>
                    </thead>
                    <tbody id="logTableBody" class="text-slate-300 divide-y divide-slate-800">
                        <!-- Rows injected here -->
                    </tbody>
                </table>
                <div id="noLogsMsg" class="hidden text-center text-slate-500 mt-10">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ</div>
            </div>
        </div>
    </div>

    <!-- Background Decoration -->
    <div class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">
        <div class="absolute top-[-10%] left-[-10%] w-72 h-72 bg-blue-600 rounded-full mix-blend-screen filter blur-3xl opacity-30 animate-blob"></div>
        <div class="absolute top-[20%] right-[-10%] w-72 h-72 bg-purple-600 rounded-full mix-blend-screen filter blur-3xl opacity-30 animate-blob animation-delay-2000"></div>
        <div class="absolute bottom-[-10%] left-[20%] w-80 h-80 bg-cyan-600 rounded-full mix-blend-screen filter blur-3xl opacity-30 animate-blob animation-delay-4000"></div>
    </div>

    <script>
        // --- Configuration ---
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwLMWFgQ27eusc73eF941Exkrrtq7RyG1IRkMKdjls0iiV20H24AdRCsZlV8ZolpBo3/exec';

        // --- Keys ---
        const LOG_STORAGE_KEY = 'rps_nhanlor_logs';
        const PLAYED_KEY_PREFIX = 'rps_nhanlor_played_'; // Legacy boolean
        const LAST_PLAYED_KEY_PREFIX = 'rps_nhanlor_last_played_'; // New Timestamp
        const RESULT_DATA_PREFIX = 'rps_nhanlor_data_';
        const CONFIG_KEY = 'rps_nhanlor_config'; // Store Admin Settings

        // --- Global Variables ---
        let visitorId = null;
        let adminClickCount = 0;
        let adminClickTimer = null;
        let countdownInterval = null;

        // Default Config
        let gameConfig = {
            cooldownType: 'none', // 'none', 'hour', 'day'
            cooldownValue: 1
        };

        const state = {
            isPlaying: false, 
            soundEnabled: true,
            hasPlayed: false,
            canPlay: true,
            pScore: 0,
            cScore: 0
        };

        const OPTIONS = ['rock', 'paper', 'scissors'];
        const EMOJIS = {'rock': '‚úä', 'paper': '‚úã', 'scissors': '‚úåÔ∏è'};
        const THAI_NAMES = {'rock': '‡∏Ñ‡πâ‡∏≠‡∏ô', 'paper': '‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©', 'scissors': '‡∏Å‡∏£‡∏£‡πÑ‡∏Å‡∏£'};
        const losingMessages = ["‡πÅ‡∏û‡πâ‡∏ã‡∏∞‡πÅ‡∏•‡πâ‡∏ß!", "‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à‡∏î‡πâ‡∏ß‡∏¢!", "‡πÇ‡∏î‡∏ô‡∏Å‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö!", "‡∏ß‡πâ‡∏≤‡∏≤‡∏≤... ‡∏û‡∏•‡∏≤‡∏î", "‡∏´‡∏ô‡∏≤‡∏ô‡∏´‡∏•‡πà‡∏≠‡∏ä‡∏ô‡∏∞!"];
        const winningMessages = ["‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î! ‡∏ä‡∏ô‡∏∞‡πÅ‡∏•‡πâ‡∏ß", "‡∏î‡∏ß‡∏á‡∏î‡∏µ‡∏°‡∏≤‡∏Å!", "‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å!", "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢!", "Winner!"];

        function generateRewardCode() {
          return 'WIN-' + Math.random().toString(36).substring(2, 7).toUpperCase();
        }

        // --- Audio Engine ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playTone(type) {
            if (!state.soundEnabled) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if (type === 'click') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(800, now);
                osc.frequency.exponentialRampToValueAtTime(300, now + 0.1);
                gainNode.gain.setValueAtTime(0.3, now); gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now); osc.stop(now + 0.1);
            } else if (type === 'win') {
                osc.type = 'triangle'; osc.frequency.setValueAtTime(523.25, now);
                osc.frequency.setValueAtTime(783.99, now + 0.2);
                gainNode.gain.setValueAtTime(0, now); gainNode.gain.linearRampToValueAtTime(0.3, now + 0.1);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 1.5);
                osc.start(now); osc.stop(now + 1.5);
            } else if (type === 'lose') {
                osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, now);
                osc.frequency.linearRampToValueAtTime(100, now + 0.4);
                gainNode.gain.setValueAtTime(0.3, now); gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
                osc.start(now); osc.stop(now + 0.5);
            }
        }

        // --- Logic: Cooldown System ---
        function checkCooldown() {
            // 1. Load Last Played Time
            const lastPlayedStr = localStorage.getItem(`${LAST_PLAYED_KEY_PREFIX}${visitorId}`);
            const legacyPlayed = localStorage.getItem(`${PLAYED_KEY_PREFIX}${visitorId}`) === 'true';

            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏•‡∏¢ -> ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ
            if (!lastPlayedStr && !legacyPlayed) return { allowed: true };

            // ‡∏ñ‡πâ‡∏≤ Admin ‡∏õ‡∏¥‡∏î Cooldown (‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
            if (gameConfig.cooldownType === 'none') {
                return { allowed: false, reason: 'limit_reached' }; 
            }

            // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ Config ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ timestamp (‡πÄ‡∏õ‡πá‡∏ô user ‡πÄ‡∏Å‡πà‡∏≤) -> ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡∏°‡πà
            if (!lastPlayedStr && legacyPlayed) {
                return { allowed: true }; 
            }

            const lastPlayed = parseInt(lastPlayedStr);
            const now = Date.now();
            let cooldownMs = 0;

            if (gameConfig.cooldownType === 'hour') {
                cooldownMs = gameConfig.cooldownValue * 60 * 60 * 1000;
            } else if (gameConfig.cooldownType === 'day') {
                cooldownMs = gameConfig.cooldownValue * 24 * 60 * 60 * 1000;
            }

            const nextPlayTime = lastPlayed + cooldownMs;

            if (now >= nextPlayTime) {
                return { allowed: true };
            } else {
                return { allowed: false, reason: 'cooldown', nextPlayTime: nextPlayTime };
            }
        }

        function startCountdown(targetTime) {
            const timerEl = document.getElementById('countdownTimer');
            if (countdownInterval) clearInterval(countdownInterval);

            function update() {
                const now = Date.now();
                const diff = targetTime - now;

                if (diff <= 0) {
                    clearInterval(countdownInterval);
                    location.reload(); // Refresh to reset state
                    return;
                }

                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                timerEl.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            update();
            countdownInterval = setInterval(update, 1000);
        }

        // --- Core Game Logic ---
        async function playRound(playerChoice) {
            if (!state.canPlay || state.hasPlayed) return;
            state.canPlay = false;

            playTone('click');
            document.getElementById('controls').classList.add('opacity-50', 'pointer-events-none');
            const battleArena = document.getElementById('battleArena');
            const statusText = document.getElementById('statusText');
            
            battleArena.classList.remove('hidden');
            battleArena.classList.add('flex');
            document.getElementById('scoreboard').classList.remove('hidden');
            document.getElementById('scoreboard').classList.add('flex');

            // Shaking Animation
            let count = 0;
            statusText.textContent = "‡πÄ‡∏õ‡πà‡∏≤...";
            document.getElementById('playerEmoji').textContent = "‚úä";
            document.getElementById('cpuEmoji').textContent = "‚úä";
            document.getElementById('playerHandDisplay').classList.add('shake-hand');
            document.getElementById('cpuHandDisplay').classList.add('shake-hand');
            document.getElementById('pHandBorder').className = "w-24 h-24 bg-white/10 rounded-full flex items-center justify-center border-4 border-blue-400 shadow-lg glass-panel transition-all";
            document.getElementById('cHandBorder').className = "w-24 h-24 bg-white/10 rounded-full flex items-center justify-center border-4 border-red-400 shadow-lg glass-panel transition-all";

            const shuffleInterval = setInterval(() => {
                count++;
                if (count === 1) statusText.textContent = "‡∏¢‡∏¥‡πâ‡∏á...";
                if (count === 2) statusText.textContent = "‡∏â‡∏∏‡∏ö!";
            }, 600);

            await new Promise(r => setTimeout(r, 1800));
            clearInterval(shuffleInterval);

            document.getElementById('playerHandDisplay').classList.remove('shake-hand');
            document.getElementById('cpuHandDisplay').classList.remove('shake-hand');

            // Result
            const cpuChoice = OPTIONS[Math.floor(Math.random() * OPTIONS.length)];
            document.getElementById('playerEmoji').textContent = EMOJIS[playerChoice];
            document.getElementById('cpuEmoji').textContent = EMOJIS[cpuChoice];
            
            document.getElementById('playerHandDisplay').classList.add('animate-bounce-hand');
            document.getElementById('cpuHandDisplay').classList.add('animate-bounce-hand');
            setTimeout(() => {
                document.getElementById('playerHandDisplay').classList.remove('animate-bounce-hand');
                document.getElementById('cpuHandDisplay').classList.remove('animate-bounce-hand');
            }, 500);

            const result = getResult(playerChoice, cpuChoice);
            
            if (result === 'draw') {
                statusText.textContent = `‡πÄ‡∏™‡∏°‡∏≠!`;
                statusText.className = "text-center h-8 font-bold text-white text-lg";
                setTimeout(() => nextRound(), 1500);
            } else if (result === 'win') {
                state.pScore++;
                updateScoreBoard();
                document.getElementById('pHandBorder').classList.replace('border-blue-400', 'border-green-400');
                statusText.textContent = "‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ!";
                statusText.className = "text-center h-8 font-bold text-green-400 text-lg";
                if (state.pScore >= 2) setTimeout(() => finalizeGame(true), 1500);
                else setTimeout(() => nextRound(), 1500);
            } else {
                state.cScore++;
                updateScoreBoard();
                document.getElementById('cHandBorder').classList.replace('border-red-400', 'border-green-400');
                statusText.textContent = "‡∏´‡∏ô‡∏≤‡∏ô‡∏´‡∏•‡πà‡∏≠‡∏ä‡∏ô‡∏∞‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ!";
                statusText.className = "text-center h-8 font-bold text-red-400 text-lg";
                if (state.cScore >= 2) setTimeout(() => finalizeGame(false), 1500);
                else setTimeout(() => nextRound(), 1500);
            }
        }

        function updateScoreBoard() {
            document.getElementById('pScore').textContent = state.pScore;
            document.getElementById('cScore').textContent = state.cScore;
            const sb = document.getElementById('scoreboard');
            sb.classList.add('scale-110');
            setTimeout(() => sb.classList.remove('scale-110'), 200);
        }

        function nextRound() {
            state.canPlay = true;
            document.getElementById('controls').classList.remove('opacity-50', 'pointer-events-none');
            document.getElementById('playerEmoji').textContent = "‚úä";
            document.getElementById('cpuEmoji').textContent = "‚úä";
            document.getElementById('pHandBorder').className = "w-24 h-24 bg-white/10 rounded-full flex items-center justify-center border-4 border-blue-400 shadow-lg glass-panel transition-all";
            document.getElementById('cHandBorder').className = "w-24 h-24 bg-white/10 rounded-full flex items-center justify-center border-4 border-red-400 shadow-lg glass-panel transition-all";
            document.getElementById('statusText').textContent = "‡∏£‡∏≠‡∏ö‡∏ï‡πà‡∏≠‡πÑ‡∏õ... ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏ß‡∏∏‡∏ò!";
            document.getElementById('statusText').className = "text-center h-8 font-bold text-yellow-200 text-lg animate-pulse";
        }

        function finalizeGame(isWin) {
            state.hasPlayed = true;
            // Record Timestamp for Cooldown
            localStorage.setItem(`${PLAYED_KEY_PREFIX}${visitorId}`, 'true');
            localStorage.setItem(`${LAST_PLAYED_KEY_PREFIX}${visitorId}`, Date.now().toString());

            const statusText = document.getElementById('statusText');
            
            if (isWin) {
                statusText.textContent = "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞‡πÅ‡∏°‡∏ï‡∏ä‡πå‡∏ô‡∏µ‡πâ";
                statusText.className = "text-center h-8 font-bold text-green-400 text-2xl drop-shadow-md";
                playTone('win');
                triggerConfetti();
                const code = generateRewardCode();
                logPlay(visitorId, true, code);
                setTimeout(() => showResultModal(true, code), 1200);
            } else {
                statusText.textContent = "‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏û‡πâ‡πÅ‡∏°‡∏ï‡∏ä‡πå‡∏ô‡∏µ‡πâ";
                statusText.className = "text-center h-8 font-bold text-red-400 text-2xl drop-shadow-md";
                playTone('lose');
                logPlay(visitorId, false, null);
                setTimeout(() => showResultModal(false, null), 1200);
            }
        }

        function getResult(p, c) {
            if (p === c) return 'draw';
            if ((p === 'rock' && c === 'scissors') || (p === 'paper' && c === 'rock') || (p === 'scissors' && c === 'paper')) return 'win';
            return 'lose';
        }

        function showResultModal(isWin, code) {
            const resultData = { isWin, code, timestamp: new Date().toISOString() };
            localStorage.setItem(`${RESULT_DATA_PREFIX}${visitorId}`, JSON.stringify(resultData));

            const modal = document.getElementById('resultModal');
            const icon = document.getElementById('modalIconContainer');
            const title = document.getElementById('modalTitle');
            const msg = document.getElementById('modalMessage');
            const reward = document.getElementById('rewardSection');
            
            if (isWin) {
                icon.className = "mx-auto w-24 h-24 rounded-full flex items-center justify-center mb-4 shadow-xl bg-gradient-to-br from-yellow-400 to-orange-500 border-4 border-white";
                document.getElementById('modalEmoji').textContent = "üèÜ";
                title.textContent = "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞!";
                title.className = "text-3xl font-extrabold mb-2 text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 to-yellow-500";
                msg.textContent = winningMessages[Math.floor(Math.random() * winningMessages.length)];
                document.getElementById('rewardCode').textContent = code;
                reward.classList.remove('hidden');
            } else {
                icon.className = "mx-auto w-24 h-24 rounded-full flex items-center justify-center mb-4 shadow-xl bg-gray-600 border-4 border-gray-500";
                document.getElementById('modalEmoji').textContent = "üò¢";
                title.textContent = "‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞";
                title.className = "text-3xl font-extrabold mb-2 text-gray-300";
                msg.textContent = losingMessages[Math.floor(Math.random() * losingMessages.length)];
                reward.classList.add('hidden');
            }

            document.getElementById('viewResultBtn').classList.remove('hidden');
            document.getElementById('gameArea').innerHTML = `
                <div class="glass-panel p-6 rounded-2xl text-center">
                    <div class="text-6xl mb-4">${isWin ? 'üéâ' : 'ü•Ä'}</div>
                    <h3 class="text-xl font-bold mb-2 text-white">‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡πâ‡∏ß</h3>
                    <p class="text-white/70 text-sm">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°‡∏™‡∏ô‡∏∏‡∏Å‡∏Å‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡∏≤‡∏ô‡∏´‡∏•‡πà‡∏≠</p>
                    <div class="mt-4 inline-block bg-white/10 px-4 py-2 rounded-full text-sm">‡∏™‡∏Å‡∏≠‡∏£‡πå: ‡∏Ñ‡∏∏‡∏ì ${state.pScore} - ${state.cScore} ‡∏´‡∏ô‡∏≤‡∏ô‡∏´‡∏•‡πà‡∏≠</div>
                </div>`;
            document.getElementById('scoreboard').classList.add('hidden');

            toggleModal(true);
        }

        function toggleModal(show) {
            const modal = document.getElementById('resultModal');
            const card = document.getElementById('modalCard');
            if (show) {
                modal.classList.remove('opacity-0', 'pointer-events-none');
                card.classList.remove('scale-90');
                card.classList.add('modal-enter', 'scale-100');
            } else {
                modal.classList.add('opacity-0', 'pointer-events-none');
                card.classList.remove('modal-enter', 'scale-100');
                card.classList.add('scale-90');
            }
        }

        // --- Admin Functions ---
        function updateAdminUI() {
            const type = document.getElementById('adminCooldownType').value;
            const valContainer = document.getElementById('adminCooldownValueContainer');
            if (type === 'none') {
                valContainer.classList.add('hidden');
            } else {
                valContainer.classList.remove('hidden');
            }
        }

        function saveAdminSettings() {
            const type = document.getElementById('adminCooldownType').value;
            const val = parseInt(document.getElementById('adminCooldownValue').value) || 1;
            
            gameConfig = { cooldownType: type, cooldownValue: val };
            localStorage.setItem(CONFIG_KEY, JSON.stringify(gameConfig));
            
            const status = document.getElementById('saveStatus');
            status.classList.remove('hidden');
            setTimeout(() => status.classList.add('hidden'), 2000);
        }

        function loadAdminSettings() {
            const saved = localStorage.getItem(CONFIG_KEY);
            if (saved) {
                gameConfig = JSON.parse(saved);
                document.getElementById('adminCooldownType').value = gameConfig.cooldownType;
                document.getElementById('adminCooldownValue').value = gameConfig.cooldownValue;
                updateAdminUI();
            }
        }

        function toggleAdminPanel(show) {
            const panel = document.getElementById('adminModal');
            if (show) {
                loadAdminSettings();
                renderLogs();
                const gsStatus = document.getElementById('gsStatus');
                const hasUrl = GOOGLE_SCRIPT_URL && GOOGLE_SCRIPT_URL.startsWith('http');
                gsStatus.textContent = hasUrl ? '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß' : '‡πÑ‡∏°‡πà‡∏û‡∏ö URL';
                gsStatus.className = hasUrl ? 'text-green-400 font-bold' : 'text-red-400';
                panel.classList.remove('hidden');
            } else {
                panel.classList.add('hidden');
            }
        }

        function logPlay(vid, isWin, code) {
            const userAgent = navigator.userAgent;
            try {
                const logs = JSON.parse(localStorage.getItem(LOG_STORAGE_KEY) || '[]');
                logs.unshift({ timestamp: new Date().toISOString(), visitorId: vid || 'Unknown', result: isWin ? 'WIN' : 'LOSE', code: code || '-', userAgent: userAgent });
                localStorage.setItem(LOG_STORAGE_KEY, JSON.stringify(logs));
            } catch (e) { console.error(e); }

            if (GOOGLE_SCRIPT_URL.startsWith('http')) {
                fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST', mode: 'no-cors', 
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ visitorId: vid, result: isWin?'WIN':'LOSE', code: code||'-', userAgent: userAgent })
                }).catch(e => console.error(e));
            }
        }

        function renderLogs() {
            const tbody = document.getElementById('logTableBody');
            tbody.innerHTML = '';
            const logs = JSON.parse(localStorage.getItem(LOG_STORAGE_KEY) || '[]');
            if (logs.length === 0) { document.getElementById('noLogsMsg').classList.remove('hidden'); return; }
            document.getElementById('noLogsMsg').classList.add('hidden');
            logs.forEach(log => {
                const tr = document.createElement('tr');
                tr.className = 'admin-row border-b border-slate-800/50';
                tr.innerHTML = `<td class="p-3 whitespace-nowrap text-slate-400">${new Date(log.timestamp).toLocaleString('th-TH')}</td>
                    <td class="p-3 font-mono text-xs text-blue-300">${log.visitorId}</td>
                    <td class="p-3 text-center ${log.result === 'WIN' ? 'text-green-400' : 'text-red-400'}">${log.result}</td>
                    <td class="p-3 text-right text-yellow-400 font-mono">${log.code}</td>`;
                tbody.appendChild(tr);
            });
        }
        
        function clearLogs() { if(confirm('‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥?')) { localStorage.removeItem(LOG_STORAGE_KEY); renderLogs(); } }
        function exportLogs() {
            const logs = JSON.parse(localStorage.getItem(LOG_STORAGE_KEY) || '[]');
            if (logs.length === 0) return alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
            let csv = "data:text/csv;charset=utf-8,Timestamp,VisitorID,Result,RewardCode,UserAgent\n" + 
                logs.map(l => `${l.timestamp},${l.visitorId},${l.result},${l.code},"${(l.userAgent||'').replace(/"/g,'""')}"`).join("\r\n");
            const link = document.createElement("a"); link.setAttribute("href", encodeURI(csv)); link.setAttribute("download", "logs.csv");
            document.body.appendChild(link); link.click(); document.body.removeChild(link);
        }

        // --- Init ---
        document.getElementById('adminTrigger').addEventListener('click', () => {
            adminClickCount++; clearTimeout(adminClickTimer);
            adminClickTimer = setTimeout(() => { adminClickCount = 0; }, 1500);
            if (adminClickCount >= 5) { adminClickCount = 0; document.getElementById('adminLoginModal').classList.remove('hidden'); }
        });
        document.getElementById('cancelLoginBtn').addEventListener('click', () => document.getElementById('adminLoginModal').classList.add('hidden'));
        document.getElementById('confirmLoginBtn').addEventListener('click', () => {
            if (document.getElementById('adminPasswordInput').value === 'admin') {
                document.getElementById('adminLoginModal').classList.add('hidden');
                toggleAdminPanel(true); document.getElementById('adminPasswordInput').value = '';
                document.getElementById('loginErrorMsg').classList.add('hidden');
            } else document.getElementById('loginErrorMsg').classList.remove('hidden');
        });

        async function init() {
            try {
                const fp = await fpPromise;
                const result = await fp.get();
                visitorId = result.visitorId;
            } catch (e) { visitorId = 'visitor_' + Math.random().toString(36); }

            // Load Config
            loadAdminSettings();

            // Check Cooldown Status
            const status = checkCooldown();

            if (status.allowed) {
                // Allowed to play
                state.canPlay = true;
                state.hasPlayed = false;
                document.getElementById('scoreboard').classList.remove('hidden');
                document.getElementById('scoreboard').classList.add('flex');
            } else {
                // Blocked
                state.hasPlayed = true;
                const savedResult = JSON.parse(localStorage.getItem(`${RESULT_DATA_PREFIX}${visitorId}`));
                
                // Hide game board controls
                document.getElementById('controls').classList.add('hidden');
                document.getElementById('statusText').classList.add('hidden');
                document.getElementById('battleArena').classList.add('hidden');
                document.getElementById('scoreboard').classList.add('hidden');

                // Show cooldown message if mode is not none
                if (gameConfig.cooldownType !== 'none' && status.nextPlayTime) {
                    document.getElementById('cooldownMsg').classList.remove('hidden');
                    startCountdown(status.nextPlayTime);
                }

                // Show previous result panel
                if (savedResult) {
                    document.getElementById('viewResultBtn').classList.remove('hidden');
                    document.getElementById('gameArea').innerHTML += `
                        <div class="glass-panel p-6 rounded-2xl text-center mt-4">
                            <h3 class="text-xl font-bold mb-2 text-white">‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß</h3>
                            <p class="text-white/70 text-sm">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°‡∏™‡∏ô‡∏∏‡∏Å‡∏Å‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡∏≤‡∏ô‡∏´‡∏•‡πà‡∏≠</p>
                        </div>`;
                }
            }
            lucide.createIcons();
        }

        document.getElementById('viewResultBtn').addEventListener('click', () => toggleModal(true));
        document.getElementById('resultModal').addEventListener('click', (e) => { if (e.target.id === 'resultModal') toggleModal(false); });
        document.getElementById('soundToggle').addEventListener('click', () => {
            state.soundEnabled = !state.soundEnabled;
            document.getElementById('soundIcon').setAttribute('data-lucide', state.soundEnabled ? 'volume-2' : 'volume-x');
            lucide.createIcons();
        });

        init();

        tailwind.config = {
            theme: { extend: { animation: { blob: "blob 7s infinite" }, keyframes: { blob: { "0%": { transform: "translate(0px, 0px) scale(1)" }, "33%": { transform: "translate(30px, -50px) scale(1.1)" }, "66%": { transform: "translate(-20px, 20px) scale(0.9)" }, "100%": { transform: "translate(0px, 0px) scale(1)" } } } } },
        }
    </script>
</body>
</html>
